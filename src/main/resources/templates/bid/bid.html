<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layout.html">
<head>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        /* ìºëŸ¬ì…€ ì „ì²´ ì˜ì—­ê³¼ ê° ìŠ¬ë¼ì´ë“œì˜ ê³ ì • ë†’ì´ ì„¤ì • (ì˜ˆ: 500px) */
        .carousel-inner,
        .carousel-item {
            height: 500px;
        }

        /* ì´ë¯¸ì§€ì— ê³ ì • ë†’ì´ì™€ ë„ˆë¹„ ì„¤ì • ë° object-fit ì†ì„± ì ìš© */
        .carousel-item img {
            width: 100%;
            height: 500px;
            object-fit: cover;
            display: block;
        }
        .floating-box {
            position: fixed;
            margin-bottom: 20em;
            right: 20px;
            bottom: 80px; /* TOP ë²„íŠ¼ê³¼ ê°„ê²© */
            width: 120px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
        }

        .floating-box h6 {
            font-size: 14px;
            margin-bottom: 10px;
            color: #444;
        }

        /* ìŠ¤í¬ë¡¤ ì˜ì—­ì„ ë‹´ë‹¹í•˜ëŠ” ì»¨í…Œì´ë„ˆ */
        .recent-items-container {
            max-height: 250px; /* ì—¬ê¸°ì„œ ì›í•˜ëŠ” ë†’ì´ë¡œ ì¡°ì • (ì˜ˆ: 7ê°œ ì •ë„ ë³´ì´ê²Œ) */
            overflow-y: auto;   /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ í™œì„±í™” */
        }

        /* í•„ìš”í•˜ë‹¤ë©´ ì´ë¯¸ì§€ í¬ê¸°ë‚˜ ì—¬ë°± ì¡°ì ˆ */
        .recent-item img {
            width: 100%;
            height: auto;
            margin-bottom: 5px;
        }

        .productBid {
            cursor: pointer;
            color: #66a6ff;
        }

    </style>
    <div class="container" layout:fragment="content">

        <!-- ìµœê·¼ ë³¸ ìƒí’ˆ ë°•ìŠ¤ -->
        <div class="floating-box" th:if="${#authentication != null && #authentication.name != 'anonymousUser'}">
            <h6>ìµœê·¼ ë³¸ ë¬¼í’ˆ</h6>
            <!-- ìŠ¤í¬ë¡¤ ì˜ì—­ -->
            <div class="recent-items-container">
                <!-- ìµœê·¼ ë³¸ ìƒí’ˆ ëª©ë¡ ë°˜ë³µ -->
                <div th:each="view : ${recentViews}">
                    <a th:href="@{/bid/bid(productId=${view.product.productId})}" class="recent-item">
                        <img th:src="${view.product.imageUrl}" alt="ìƒí’ˆ ì´ë¯¸ì§€">
                    </a>
                </div>
            </div>
            <!-- TOP ë²„íŠ¼ -->
            <button id="topBtn" class="top-btn hide">TOP</button>
        </div>

        <div class="container mt-5">
            <div class="row">
                <!-- ìƒí’ˆ ì´ë¯¸ì§€ ì˜ì—­ -->
                <div class="col-md-6 d-flex flex-column align-items-center">

                    <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-inner">
                            <div th:each="image, iterStat : ${carouselImages}"
                                 class="carousel-item"
                                 th:classappend="${iterStat.index == 0} ? ' active' : ''">
                                <img th:src="@{${image.url}}" class="d-block w-100" th:alt="${image.alt}"/>
                            </div>
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls"
                                data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">ì´ì „</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls"
                                data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">ë‹¤ìŒ</span>
                        </button>
                    </div>
                    <!-- íŒë§¤ì ì •ë³´ -->
                    <div class="mt-3 d-flex align-items-center w-100">
                        <img th:src="${inform.getProfileImage()}" class="rounded-circle" width="50" height="50"
                             alt="íŒë§¤ì í”„ë¡œí•„">
                        <div class="ms-3">
                            <p class="mb-0 fw-bold">
                                <span class="productBid"
                                      th:text="${inform.getUserName()}"
                                      th:attr="data-sellername=${inform.getUserName()}"
                                      onclick="handleSellerClick(event)"></span>
                            </p>


                            <p class="mb-0 text-muted">íŒë§¤ì ì ìˆ˜: <span th:text="${inform.getReputation()}+'ì '">100ì </span>
                            </p>
                        </div>
                        <button class="btn btn-primary ms-auto" id="chattingBtn">ì±„íŒ…í•˜ê¸°</button>
                    </div>
                </div>

                <!-- ìƒí’ˆ ì •ë³´ ë° ê²½ë§¤ ìƒì„¸ -->
                <div class="col-md-6">

                    <div class="d-flex justify-content-between align-items-center">
                        <h2 class="fw-bold" th:text="${inform.getName()}" id="product_na">ìƒí’ˆëª…</h2>
                        <h5 style="color: red; margin-left: 300px; margin-top: 10px"
                            th:if="${tempMaxBidUser == tokenName and product.status != 'íŒë§¤ì™„ë£Œ'}" th:text="'í˜„ì¬ ìµœê³ ê°€ ì…ì°°ì¤‘!'" class="fw-bold"></h5>
                        <div>
                            <!-- ê´€ì‹¬í’ˆëª©: ì±„ì›Œì§„ í•˜íŠ¸ ì•„ì´ì½˜ -->
                            <button class="btn btn-outline-secondary btn-sm me-2" title="ê´€ì‹¬í’ˆëª©" id="interestBtn">
                                <i id="interestIcon"
                                   th:class="${isLikeProduct} ? 'bi bi-heart-fill' : 'bi bi-heart'"></i>
                            </button>
                            <!-- ì‹ ê³ í•˜ê¸°: ê²½ê³  ì‚¼ê°í˜• ì•„ì´ì½˜ (ì‚¬ì´ë Œ ëŒ€ì²´) -->
                            <button class="btn btn-outline-danger btn-sm" title="ì‹ ê³ í•˜ê¸°" id="reportBtn">
                                <i class="bi bi-exclamation-triangle-fill"></i>
                            </button>
                        </div>
                    </div>


                    <p class="text-muted fs-5">í˜„ì¬ê°€ <strong class="text-danger"
                                                           th:text="${T(java.lang.String).format('%,d ì›', inform.getTempPrice())}">0ì›</strong>
                    </p>

                    <div class="border p-3 rounded bg-light">
                        <br>
                        <p><strong>ë‚¨ì€ ì‹œê°„ : </strong><span id="timer">3ì¼ 14ì‹œê°„ 55ë¶„ 56ì´ˆ</span></p>

                        <!-- ì…ì°° ìˆ˜ì™€ ì²´í¬ë°•ìŠ¤ ì˜ì—­ (d-flexë¡œ ì¢Œìš° ë°°ì¹˜) -->
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <p class="mb-0"><strong>ì…ì°° ìˆ˜ :</strong> <span
                                        th:text="${inform.getBidCount()}+'íšŒ'">0íšŒ</span></p>
                            </div>
                            <div>
                                <div class="form-check form-check-inline" th:if="${inform.dealType==0}">
                                    <a>ğŸ§‘ğŸ» ì§ê±°ë˜ ê°€ëŠ¥</a>
                                </div>
                                <div class="form-check form-check-inline" th:if="${inform.dealType==1}">
                                    <a>ğŸšš íƒë°°ê±°ë˜ ê°€ëŠ¥</a>
                                </div>
                                <div class="form-check form-check-inline" th:if="${inform.dealType==2}">
                                    <a>ğŸ§‘ğŸ»ğŸšš ì§ê±°ë˜, íƒë°°ê±°ë˜ ê°€ëŠ¥</a>
                                </div>

                            </div>
                        </div>

                        <!-- ì–‡ì€ íšŒìƒ‰ ì„  -->
                        <hr class="my-2" style="border-color: #ddd;">

                        <p class="mb-0"><strong>ìµœì†Œ ì…ì°° ë‹¨ìœ„ : </strong><span
                                th:text="${T(java.lang.String).format('%,d ì›', inform.getMinIncrement())}">1,000ì›</span>
                        </p>
                        <br>

                        <p><strong>ì¦‰ì‹œ êµ¬ë§¤ê°€ : </strong><span
                                th:text="${T(java.lang.String).format('%,d ì›', inform.getPrice())}">60,000ì›</span></p>
                        <div class="mt-3 d-flex align-items-center">
                            <label for="desiredBid" class="me-2"><strong>í¬ë§ ì…ì°°ê°€ :</strong></label>
                            <input type="number" id="desiredBid" class="form-control w-50" placeholder="ì…ì°°ê°€ ì…ë ¥">
                            <label style="margin-left: 20px" id="ableBid"></label>
                        </div>
                        <p class="mt-2"><strong>ì˜ˆìƒ êµ¬ë§¤ê°€ : </strong><span id="estimatedPrice">0ì›</span>(êµ¬ë§¤ ìˆ˜ìˆ˜ë£Œ í¬í•¨)</p>
                        <p class="mt-2"><strong>ìµœê³  ì…ì°°ì : </strong><span id="maxBidUser"
                                                                        th:text="${tempMaxBidUser}"></span></p>


                    </div>


                    <div class="mt-3">
                        <!-- ì¦‰ì‹œ êµ¬ë§¤ ë²„íŠ¼ì„ ìµœìƒë‹¨ìœ¼ë¡œ ë°°ì¹˜í•˜ì—¬ ìš°ì„ ìˆœìœ„ ê°•ì¡° -->
                        <button class="btn btn-danger w-100 py-2 mb-2" id="tempBuyBtn">ì¦‰ì‹œ êµ¬ë§¤í•˜ê¸°</button>

                        <!-- ì…ì°° ê´€ë ¨ ë²„íŠ¼ ê·¸ë£¹í™” -->
                        <div class="d-flex gap-2">
                            <button class="btn btn-dark flex-grow-1 py-2" id="bidBtn">ì…ì°°í•˜ê¸°</button>
                            <button class="btn btn-success flex-grow-1 py-2" id="autoBidBtn">ìë™ì…ì°°</button>
                        </div>
                    </div>
                </div>


                <!-- ìƒí’ˆ ìƒì„¸ ì •ë³´ ì„¹ì…˜ -->
                <div class="container mt-5">
                    <h3 class="mb-4">ìƒí’ˆ ìƒì„¸ ì •ë³´</h3>
                    <!-- íƒ­ ë©”ë‰´ -->
                    <ul class="nav nav-tabs" id="productTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="description-tab" data-bs-toggle="tab"
                                    data-bs-target="#description" type="button" role="tab" aria-controls="description"
                                    aria-selected="true">
                                ì„¤ëª…
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="specs-tab" data-bs-toggle="tab" data-bs-target="#specs"
                                    type="button" role="tab" aria-controls="specs" aria-selected="false">
                                ì •ë³´
                            </button>
                        </li>
                    </ul>
                    <!-- íƒ­ ì»¨í…ì¸  -->
                    <div class="tab-content" id="productTabContent">
                        <!-- ì„¤ëª… íƒ­ -->
                        <div class="tab-pane fade show active p-3" id="description" role="tabpanel"
                             aria-labelledby="description-tab">
                            <p th:text="${inform.getDescription()}"></p>
                        </div>
                        <!-- ì‚¬ì–‘ íƒ­ -->
                        <div class="tab-pane fade p-3" id="specs" role="tabpanel" aria-labelledby="specs-tab">
                            <table class="table table-striped">
                                <tbody>
                                <tr>
                                    <th scope="row">ìƒí’ˆëª…</th>
                                    <td th:text="${inform.name}">ìƒí’ˆëª…</td>
                                </tr>
                                <tr>
                                    <th scope="row">íŒë§¤ì ì´ë¦„</th>
                                    <td th:text="${inform.userName}">íŒë§¤ì ì´ë¦„</td>
                                </tr>
                                <tr>
                                    <th scope="row">ê±°ë˜ ì£¼ì†Œ</th>
                                    <td th:text="${inform.location}">ê±°ë˜ ì£¼ì†Œ</td>
                                </tr>
                                <tr>
                                    <th scope="row">ì¡°íšŒìˆ˜</th>
                                    <td th:text="${inform.viewCount}">ì¡°íšŒìˆ˜</td>
                                </tr>
                                <tr>
                                    <th scope="row">ì¢‹ì•„ìš” ìˆ˜</th>
                                    <td th:text="${inform.likeCount}">ì¢‹ì•„ìš” ìˆ˜</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ìœ ì‚¬í•œ ìƒí’ˆ ì„¹ì…˜ -->
            <div class="container mt-5">
                <h3 class="mb-4">ì´ ìƒí’ˆê³¼ ìœ ì‚¬í•œ ìƒí’ˆ</h3>
                <!-- row-cols-*ì™€ í•¨ê»˜ align-items-stretchë¡œ ëª¨ë“  colì´ ë™ì¼ ë†’ì´ë¡œ í™•ì¥ -->
                <div class="row row-cols-1 row-cols-md-3 row-cols-lg-5 g-4 align-items-stretch">
                    <div class="col" th:each="similarProduct : ${similarProducts}">
                        <!-- ì¹´ë“œ ì „ì²´ ë†’ì´ë¥¼ 100%ë¡œ ì„¤ì • -->
                        <div class="card h-100 shadow-sm">
                            <!-- ì´ë¯¸ì§€ ì˜ì—­ì— ê³ ì • ë†’ì´ ì§€ì • + object-fitìœ¼ë¡œ ê· ì¼í•˜ê²Œ ë§ì¶¤ -->
                            <img th:src="@{${similarProduct.imageUrl}}" class="card-img-top"
                                 alt="ìœ ì‚¬ ìƒí’ˆ ì´ë¯¸ì§€" style="height: 200px; object-fit: cover;"
                                 onerror="this.src='/images/default-product.png'">

                            <!-- ì¹´ë“œ ë³¸ë¬¸ì„ flex ì»¨í…Œì´ë„ˆë¡œ ë§Œë“¤ì–´, ë‚´ìš©ì´ ë¶€ì¡±í•´ë„ í•˜ë‹¨ì— ë²„íŠ¼ ê³ ì • ê°€ëŠ¥ -->
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title text-truncate" th:text="${similarProduct.name}">ìƒí’ˆëª…</h5>
                                <p class="card-text text-danger fw-bold"
                                   th:text="${T(java.lang.String).format('%,d ì›', similarProduct.price)}">0ì›</p>

                                <!-- ì•„ë˜ìª½ì— ë°°ì¹˜í•  ë‚´ìš©ì€ mt-autoë¡œ ì¹´ë“œ í•˜ë‹¨ì— ë¶™ì„ -->
                                <div class="mt-auto">
                                    <a th:href="@{/bid/bid(productId=${similarProduct.productId})}"
                                       class="btn btn-primary w-100">ìƒí’ˆ ë³´ê¸°</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
        <script>


            // Thymeleafë¥¼ ì‚¬ìš©í•˜ì—¬ inform.totalTime ê°’ì„ ìë°”ìŠ¤í¬ë¦½íŠ¸ ë³€ìˆ˜ì— í• ë‹¹ (ì´ˆ ë‹¨ìœ„)
            var totalTime = [[${inform.totalTime}]];
            var productId = "[[${productId}]]";
            var bidCount = [[${inform.bidCount}]];
            var productStatus = "[[${product.status}]]";

            function updateTimer() {
                // totalTimeì´ ìŒìˆ˜ê°€ ë˜ë©´ íƒ€ì´ë¨¸ ì¢…ë£Œ
                if (totalTime < 0 || productStatus === "íŒë§¤ì™„ë£Œ") {
                    clearInterval(timerInterval);
                    document.getElementById("timer").textContent = "ì¢…ë£Œ";

                    // ì¦‰ì‹œ êµ¬ë§¤, ì…ì°°, ìë™ì…ì°° ë²„íŠ¼ ë¹„í™œì„±í™”
                    document.getElementById("tempBuyBtn").disabled = true;
                    document.getElementById("bidBtn").disabled = true;
                    document.getElementById("autoBidBtn").disabled = true;

                    return;
                }

                // ë‚¨ì€ ì‹œê°„ì„ ì¼/ì‹œê°„/ë¶„/ì´ˆë¡œ ê³„ì‚°
                var days = Math.floor(totalTime / (24 * 3600));
                var hours = Math.floor((totalTime % (24 * 3600)) / 3600);
                var minutes = Math.floor((totalTime % 3600) / 60);
                var seconds = totalTime % 60;

                // í‘œì‹œ í˜•ì‹ (ì˜ˆ: "3ì¼ 14ì‹œê°„ 55ë¶„ 56ì´ˆ")
                var display = days + "ì¼ " + hours + "ì‹œê°„ " + minutes + "ë¶„ " + seconds + "ì´ˆ";

                // íƒ€ì´ë¨¸ ìš”ì†Œì— í‘œì‹œ
                document.getElementById("timer").textContent = display;

                // ì´ˆ ë‹¨ìœ„ 1ì”© ê°ì†Œ
                totalTime--;
            }

            // í˜ì´ì§€ ë¡œë“œ í›„ 1ì´ˆë§ˆë‹¤ updateTimer í•¨ìˆ˜ í˜¸ì¶œ
            updateTimer(); // ì²« í˜¸ì¶œ
            var timerInterval = setInterval(updateTimer, 1000);

            calculateFee()
            bid()
            autoBid()
            buy()
            report()
            chatting()
            like()


            function ablePrice() {

                var bidInput = document.getElementById("desiredBid");
                var estimatedPriceElement = document.getElementById("estimatedPrice");

                var immediatePrice = [[${inform.price}]];
                var tempPrice = [[${inform.tempPrice}]];
                var minIncrement = [[${inform.minIncrement}]];

                var bidValue = parseInt(bidInput.value) || 0; // ê°’ì´ ì—†ìœ¼ë©´ 0 ì²˜ë¦¬
                var estimatedPrice = parseInt(parseFloat(bidValue) * 1.05); // ì˜ˆìƒ ê°€ê²© ê³„ì‚°
                estimatedPriceElement.textContent = estimatedPrice.toLocaleString() + " ì›"; // ì½¤ë§ˆ í¬í•¨í•œ ìˆ«ì í‘œì‹œ
                if (bidValue < immediatePrice && (tempPrice + minIncrement) <= bidValue) {
                    return true;
                } else {
                    return false;
                }
            }

            function calculateFee() {

                document.addEventListener("DOMContentLoaded", function () {
                    var bidInput = document.getElementById("desiredBid");
                    var estimatedPriceElement = document.getElementById("estimatedPrice");
                    var ableBid = document.getElementById("ableBid");


                    var immediatePrice = [[${inform.price}]];
                    var tempPrice = [[${inform.tempPrice}]];
                    var minIncrement = [[${inform.minIncrement}]];

                    // ì…ë ¥ ê°’ì´ ë³€ê²½ë  ë•Œ ì˜ˆìƒ êµ¬ë§¤ê°€ ì—…ë°ì´íŠ¸
                    bidInput.addEventListener("input", function () {
                        var bidValue = parseInt(bidInput.value) || 0; // ê°’ì´ ì—†ìœ¼ë©´ 0 ì²˜ë¦¬
                        var estimatedPrice = parseInt(parseFloat(bidValue) * 1.05); // ì˜ˆìƒ ê°€ê²© ê³„ì‚°
                        estimatedPriceElement.textContent = estimatedPrice.toLocaleString() + " ì›"; // ì½¤ë§ˆ í¬í•¨í•œ ìˆ«ì í‘œì‹œ
                        if (bidValue < immediatePrice && (tempPrice + minIncrement) <= bidValue) {
                            ableBid.innerText = "ê°€ëŠ¥í•œ ê°€ê²© ì…ë‹ˆë‹¤.";
                            ableBid.style.color = "green";
                        } else {
                            ableBid.innerText = "ë¶ˆê°€ëŠ¥í•œ ê°€ê²© ì…ë‹ˆë‹¤.";
                            ableBid.style.color = "red";
                        }

                    });
                });

            }

            // ì…ì°°ê¸°ëŠ¥ êµ¬í˜„
            function bid() {
                document.addEventListener("DOMContentLoaded", function () {

                    var bidBtn = document.getElementById("bidBtn");

                    var tokenId = "[[${tokenId}]]";
                    var sellerId = "[[${sellerId}]]";

                    if (tokenId === sellerId) {
                        bidBtn.innerText = "ìˆ˜ì •í•˜ê¸°";
                    }

                    bidBtn.addEventListener("click", function () {

                        var bidAmount = parseInt(document.getElementById("desiredBid").value) || 0;


                        if (tokenId === "guest") {
                            if (confirm("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤.\në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                                // í™•ì¸ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                                window.location.href = "/login";
                            }
                        } else {
                            if (tokenId === sellerId) {
                                // íŒë§¤ìì¸ ê²½ìš°, ì…ì°° ê±´ìˆ˜ê°€ ìˆìœ¼ë©´ ìˆ˜ì • ë¶ˆê°€ëŠ¥, ì—†ìœ¼ë©´ ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™
                                if (bidCount > 0) {
                                    alert("ì´ë¯¸ ì…ì°°ì¤‘ì´ë¼ ìˆ˜ì •ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.");
                                } else {
                                    window.location.href = "/product/update?productId=" + productId;
                                }
                            } else if ("[[${tempMaxBidUser}]]" === "[[${tokenName}]]") {
                                alert("í˜„ì¬ ìµœê³ ê°€ ì…ì°° ì¤‘ ì…ë‹ˆë‹¤.")
                            } else {

                                // axiosë¥¼ ì‚¬ìš©í•˜ì—¬ ì…ì°° ìš”ì²­ ì „ì†¡
                                if (ablePrice()) {
                                    axios.post('/bid/place', {
                                        productId: productId,
                                        userId: tokenId,
                                        bidAmount: bidAmount
                                    })
                                        .then(function (response) {
                                            if (response.status === 200) {
                                                // ì‘ì—… ì‹¤í–‰: ì˜ˆë¥¼ ë“¤ì–´, í˜„ì¬ê°€ ì—…ë°ì´íŠ¸, ì…ì°° ìˆ˜ ì¦ê°€ ë“±
                                                alert(response.data);
                                                window.location.reload();
                                            }
                                        })
                                        .catch(function (error) {
                                            alert("ì…ì°° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                                            console.error(error);
                                        });
                                } else {
                                    alert("êµ¬ë§¤ ê°€ëŠ¥í•œ ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                                }


                            }
                        }

                    });
                });
            }

            // ìë™ ì…ì°° ê¸°ëŠ¥ êµ¬í˜„

            function autoBid() {
                document.addEventListener("DOMContentLoaded", function () {

                    var autoBidBtn = document.getElementById("autoBidBtn");

                    var tokenId = "[[${tokenId}]]";
                    var sellerId = "[[${sellerId}]]";

                    if (tokenId === sellerId) {
                        autoBidBtn.innerText = "ì‚­ì œí•˜ê¸°";
                    }

                    autoBidBtn.addEventListener("click", function () {

                        if (tokenId === "guest") {
                            if (confirm("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤.\në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                                // í™•ì¸ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                                window.location.href = "/login";
                            }
                        } else if ("[[${tempMaxBidUser}]]" === "[[${tokenName}]]") {
                            alert("í˜„ì¬ ìµœê³ ê°€ ì…ì°° ì¤‘ ì…ë‹ˆë‹¤.")
                        } else {
                            if (tokenId === sellerId) {
                                // íŒë§¤ìì¸ ê²½ìš°, ì…ì°° ê±´ìˆ˜ê°€ ìˆìœ¼ë©´ ì‚­ì œ ë¶ˆê°€ëŠ¥, ì—†ìœ¼ë©´ ì‚­ì œ ìš”ì²­ ì§„í–‰
                                if (bidCount > 0) {
                                    alert("ì´ë¯¸ ì…ì°°ì¤‘ì´ë¼ ì‚­ì œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.");
                                } else {
                                    if (confirm("ì •ë§ë¡œ ìƒí’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                                        axios.post('/product/delete', {productId: productId})
                                            .then(function (response) {
                                                alert(response.data);
                                                window.location.href = "/";
                                            })
                                            .catch(function (error) {
                                                alert("ì‚­ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                                                console.error(error);
                                            });
                                    }
                                }
                            } else {
                                // ìë™ì…ì°° ëª¨ë‹¬ ë„ìš°ê¸°
                                var autoBidModal = new bootstrap.Modal(document.getElementById('autoBidModal'));
                                autoBidModal.show();

                            }
                        }

                    });

                    // ëª¨ë‹¬ ë‚´ í™•ì¸ ë²„íŠ¼ í´ë¦­ ì²˜ë¦¬
                    document.getElementById("autoBidConfirmBtn").addEventListener("click", function () {
                        var maxBidInput = document.getElementById("maxBidAmount");

                        var immediatePrice = [[${inform.price}]];
                        var tempPrice = [[${inform.tempPrice}]];
                        var minIncrement = [[${inform.minIncrement}]];

                        var maxBidAmount = parseInt(maxBidInput.value) || 0;
                        if (maxBidAmount < immediatePrice && (tempPrice + minIncrement) <= maxBidAmount) {
                            // axiosë¥¼ ì´ìš©í•´ ìë™ì…ì°° ìš”ì²­ ì „ì†¡
                            axios.post('/bid/auto', {
                                productId: productId,
                                userId: tokenId,
                                maxBidAmount: maxBidAmount
                            })
                                .then(function (response) {
                                    alert(response.data);
                                    // í•„ìš”ì‹œ í˜„ì¬ê°€ ì—…ë°ì´íŠ¸ ë“± í›„ì²˜ë¦¬
                                    // ëª¨ë‹¬ ë‹«ê¸°
                                    var autoBidModal = bootstrap.Modal.getInstance(document.getElementById('autoBidModal'));
                                    autoBidModal.hide();
                                    window.location.reload();
                                })
                                .catch(function (error) {
                                    alert("ìë™ ì…ì°° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                                    console.error(error);
                                });
                        } else {
                            alert("ì˜¬ë°”ë¥¸ ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                        }

                    });

                });
            }

            // ì¦‰ì‹œ êµ¬ë§¤í•˜ê¸° ê¸°ëŠ¥ êµ¬í˜„
            function buy() {
                document.addEventListener("DOMContentLoaded", function () {

                    var tempBuyBtn = document.getElementById("tempBuyBtn");

                    var tokenId = "[[${tokenId}]]";
                    var sellerId = "[[${sellerId}]]";

                    tempBuyBtn.addEventListener("click", function () {

                        if (tokenId === "guest") {
                            if (confirm("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤.\në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                                // í™•ì¸ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                                window.location.href = "/login";
                            }
                        } else {
                            if (tokenId === sellerId) {
                                alert("ë³¸ì¸ ë¬¼ê±´ì€ ì¦‰ì‹œêµ¬ë§¤ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                            } else {
                                // ì¦‰ì‹œêµ¬ë§¤
                                window.location.href = "/order/order?productId=" + [[${productId}]];
                            }
                        }
                    });
                });
            }

            // ì‹ ê³ í•˜ê¸° ê¸°ëŠ¥ êµ¬í˜„
            function report() {

                document.addEventListener("DOMContentLoaded", function () {

                    var reportBtn = document.getElementById("reportBtn");
                    var tokenId = "[[${tokenId}]]";
                    var sellerId = "[[${sellerId}]]";

                    reportBtn.addEventListener("click", function () {

                        if (tokenId === "guest") {
                            if (confirm("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤.\në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                                // í™•ì¸ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                                window.location.href = "/login";
                            }
                        } else {
                            if (tokenId === sellerId) {
                                alert("ë³¸ì¸ ë¬¼ê±´ì€ ì‹ ê³  í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                            } else {
                                // ì¦‰ì‹œêµ¬ë§¤
                                window.location.href = "/bid/report?reported=" + [[${productId}]];
                            }
                        }
                    });
                });

            }

            // ì±„íŒ…í•˜ê¸° ê¸°ëŠ¥êµ¬í˜„
            function chatting() {
                document.addEventListener("DOMContentLoaded", function () {

                    var chattingBtn = document.getElementById("chattingBtn");
                    var tokenId = "[[${tokenId}]]";
                    var sellerId = [[${sellerId}]];
                    var productId = [[${productId}]];

                    chattingBtn.addEventListener("click", function () {

                        if (tokenId === "guest") {
                            if (confirm("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤.\në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                                // í™•ì¸ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                                window.location.href = "/login";
                            }
                        } else {
                            if (tokenId === sellerId) {
                                alert("ë³¸ì¸ê³¼ ì±„íŒ… í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                            } else {
                                // ì±„íŒ…ë°©
                                window.location.href = "/chat/mychat?userId=" + tokenId + "&productId=" + productId;
                            }
                        }

                    });


                });

            }

            // ìƒí’ˆ ì¢‹ì•„ìš” ê¸°ëŠ¥ êµ¬í˜„
            function like() {
                document.addEventListener("DOMContentLoaded", function () {

                    document.getElementById("interestBtn").addEventListener("click", function () {

                        var isLoggedIn = [[${tokenId != 'guest'}]];

                        if (!isLoggedIn || isLoggedIn === "false") {
                            // confirm ì°½ì˜ ê¸°ë³¸ ë²„íŠ¼ì€ ë¸Œë¼ìš°ì €ì— ë”°ë¼ "í™•ì¸"/"ì·¨ì†Œ"ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
                            // "í™•ì¸"ì„ ëˆ„ë¥´ë©´ true, "ì·¨ì†Œ"(í˜¹ì€ ì•„ë‹ˆì˜¤)ë¥¼ ëˆ„ë¥´ë©´ false ë°˜í™˜.
                            if (confirm("ë¡œê·¸ì¸ í›„ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                                // ì‚¬ìš©ìê°€ í™•ì¸ì„ ëˆ„ë¥¸ ê²½ìš° ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                                window.location.href = '/login';
                            }
                            return; // ë¡œê·¸ì¸í•˜ì§€ ì•Šì•˜ë‹¤ë©´ ì´í›„ ë™ì‘ ì¤‘ë‹¨
                        }


                        const icon = document.getElementById("interestIcon");


                        fetch("/api/like", {
                            method: "POST",
                            headers: {"Content-Type": "application/json"},
                            body: JSON.stringify({
                                productId: [[${productId}]]
                            })
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.liked) {
                                    icon.classList.remove("bi-heart");
                                    icon.classList.add("bi-heart-fill")
                                } else {
                                    icon.classList.remove("bi-heart-fill");
                                    icon.classList.add("bi-heart");
                                }
                            })
                            .catch(error => console.error("Error:", error));

                    });

                });

            }


        </script>

        <!-- ìë™ì…ì°° ëª¨ë‹¬ (Bootstrap 5 Modal) -->
        <div class="modal fade" id="autoBidModal" tabindex="-1" aria-labelledby="autoBidModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="autoBidModalLabel">ìë™ ì…ì°° ì„¤ì •</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="maxBidAmount" class="form-label">ìµœëŒ€ ìë™ ì…ì°° ê¸ˆì•¡</label>
                            <input type="number" class="form-control" id="maxBidAmount" placeholder="ìµœëŒ€ ì…ì°° ê¸ˆì•¡ ì…ë ¥">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="autoBidConfirmBtn">í™•ì¸</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    </div>
                </div>
            </div>
        </div>


    </div>
</html>